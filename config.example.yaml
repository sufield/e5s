# Example mTLS Configuration
# Copy this file to config.yaml and customize for your environment
#
# Environment variables will override values in this file:
# - SPIRE_AGENT_SOCKET overrides spire.socket_path
# - SPIRE_TRUST_DOMAIN overrides spire.trust_domain
# - HTTP_ADDRESS overrides http.address
# - HTTP_PORT overrides http.port
# - HTTP_ENABLED overrides http.enabled
# - HTTP_TIMEOUT overrides http.timeout
# - HTTP_READ_HEADER_TIMEOUT overrides http.read_header_timeout
# - HTTP_READ_TIMEOUT overrides http.read_timeout
# - HTTP_WRITE_TIMEOUT overrides http.write_timeout
# - HTTP_IDLE_TIMEOUT overrides http.idle_timeout
# - AUTH_PEER_VERIFICATION overrides http.authentication.peer_verification
# - ALLOWED_CLIENT_ID overrides http.authentication.allowed_id
# - ALLOWED_IDS overrides http.authentication.allowed_ids (comma-separated)
# - EXPECTED_SERVER_ID overrides http.authentication.allowed_id (for clients)
# - AUTH_TRUST_DOMAIN overrides http.authentication.trust_domain

# HTTP Server/Client Configuration
http:
  # Enable HTTP server/client
  enabled: true

  # Port to listen on (will be converted to :port format for address)
  port: 8443

  # Or specify full address (takes precedence over port)
  address: ":8443"

  # Client request timeout (how long to wait for server response)
  timeout: 30s

  # Server-side timeouts (security and performance tuning)
  # These protect against slow client attacks and resource exhaustion

  # ReadHeaderTimeout: Maximum time to read request headers
  # Prevents Slowloris attacks (clients sending headers very slowly)
  read_header_timeout: 10s

  # ReadTimeout: Maximum time to read entire request (headers + body)
  # Prevents clients from holding connections open indefinitely
  read_timeout: 30s

  # WriteTimeout: Maximum time to write response
  # Prevents slow clients from blocking server resources
  write_timeout: 30s

  # IdleTimeout: Maximum time to wait for next request on keep-alive connections
  # Closes idle connections to free resources
  idle_timeout: 120s

  # Authentication configuration
  # NOTE: This library only handles AUTHENTICATION (identity verification)
  # Authorization (access control) is the application's responsibility
  authentication:
    # Peer verification options:
    # - "any": Accept any authenticated client/server from SPIRE
    # - "trust-domain": Accept clients/servers from specific trust domain
    # - "specific-id": Accept only a specific SPIFFE ID
    # - "one-of": Accept one of multiple specific SPIFFE IDs
    peer_verification: trust-domain

    # Trust domain for "trust-domain" policy
    # If not specified, uses spire.trust_domain
    trust_domain: example.org

    # Single allowed SPIFFE ID for "specific-id" policy
    # For servers: allowed client ID
    # For clients: expected server ID
    # allowed_id: spiffe://example.org/service/client

    # Multiple allowed SPIFFE IDs for "one-of" policy
    # allowed_ids:
    #   - spiffe://example.org/service/client1
    #   - spiffe://example.org/service/client2
    #   - spiffe://example.org/service/client3

# SPIRE Configuration
spire:
  # Path to SPIRE agent socket
  # Default: unix:///tmp/spire-agent/public/api.sock
  socket_path: unix:///tmp/spire-agent/public/api.sock

  # Trust domain for this deployment
  # Must match the SPIRE server configuration
  trust_domain: example.org

---
# Example configurations for different scenarios

# Example 1: Development - Accept any authenticated client
# http:
#   enabled: true
#   address: ":8443"
#   authentication:
#     peer_verification: any
# spire:
#   socket_path: unix:///tmp/spire-agent/public/api.sock
#   trust_domain: example.org

# Example 2: Production - Specific client allowed
# http:
#   enabled: true
#   address: ":8443"
#   authentication:
#     peer_verification: specific-id
#     allowed_id: spiffe://example.org/service/client
# spire:
#   socket_path: unix:///var/run/spire/agent.sock
#   trust_domain: production.example.org

# Example 3: Multi-environment - Trust domain restriction
# http:
#   enabled: true
#   address: ":8443"
#   authentication:
#     peer_verification: trust-domain
#     trust_domain: production.example.org
# spire:
#   socket_path: unix:///var/run/spire/agent.sock
#   trust_domain: production.example.org

# Example 4: Load balancer - Multiple allowed clients
# http:
#   enabled: true
#   address: ":8443"
#   authentication:
#     peer_verification: one-of
#     allowed_ids:
#       - spiffe://example.org/gateway/instance-1
#       - spiffe://example.org/gateway/instance-2
#       - spiffe://example.org/gateway/instance-3
# spire:
#   socket_path: unix:///var/run/spire/agent.sock
#   trust_domain: example.org

# Example 5: Kubernetes deployment
# http:
#   enabled: true
#   address: ":8443"
#   timeout: 60s
#   authentication:
#     peer_verification: trust-domain
#     trust_domain: k8s.example.org
# spire:
#   socket_path: unix:///spire-agent-socket/api.sock
#   trust_domain: k8s.example.org
