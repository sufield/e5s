apiVersion: v1
kind: ConfigMap
metadata:
  name: e5s-config
  namespace: default
data:
  e5s.yaml: |
    spire:
      # Path to SPIRE Agent socket inside Kubernetes pods
      workload_socket: unix:///spire/agent-socket/spire-agent.sock

      # (Optional) How long to wait for identity from SPIRE before failing startup
      # If not set, defaults to 30s
      # initial_fetch_timeout: 30s

    server:
      listen_addr: ":8443"
      # Only accept the specific registered client SPIFFE ID
      # This demonstrates zero-trust: even if SPIRE auto-registers other service accounts,
      # the server only accepts the explicitly authorized client identity
      allowed_client_spiffe_id: "spiffe://example.org/ns/default/sa/default"

    client:
      expected_server_trust_domain: "example.org"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: client-config
  namespace: default
data:
  client-config.yaml: |
    # Application-specific configuration
    # Server URL for Kubernetes service discovery
    server_url: "https://e5s-server:8443/time"